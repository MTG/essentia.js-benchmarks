var EssentiaModel=function(t){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,r)};function r(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}function o(t,e,r,o){return new(r||(r=Promise))((function(n,i){function s(t){try{u(o.next(t))}catch(t){i(t)}}function a(t){try{u(o.throw(t))}catch(t){i(t)}}function u(t){t.done?n(t.value):new r((function(e){e(t.value)})).then(s,a)}u((o=o.apply(t,e||[])).next())}))}function n(t,e){var r,o,n,i,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,o&&(n=2&i[0]?o.return:i[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,i[1])).done)return n;switch(o=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(n=s.trys,(n=n.length>0&&n[n.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){s.label=i[1];break}if(6===i[0]&&s.label<n[1]){s.label=n[1],n=i;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(i);break}n[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],o=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}
/**
     * @license
     * Copyright (C) 2006-2020  Music Technology Group - Universitat Pompeu Fabra
     *
     * This file is part of Essentia
     *
     * Essentia is free software: you can redistribute it and/or modify it under
     * the terms of the GNU Affero General Public License as published by the Free
     * Software Foundation (FSF), either version 3 of the License, or (at your
     * option) any later version.
     *
     * This program is distributed in the hope that it will be useful, but WITHOUT
     * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
     * FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more
     * details.
     *
     * You should have received a copy of the Affero GNU General Public License
     * version 3 along with this program.  If not, see http://www.gnu.org/licenses/
     */var i=function(){function t(t,e,r){void 0===e&&(e="musicnn"),void 0===r&&(r=!1),this.essentia=null,this.module=null,this.essentia=new t.EssentiaJS(r),this.module=t,this.extractorType=e}return t.prototype.arrayToVector=function(t){return this.module.arrayToVector(t)},t.prototype.vectorToArray=function(t){return this.module.vectorToArray(t)},t.prototype.getAudioBufferFromURL=function(t,e){return o(this,void 0,void 0,(function(){var r;return n(this,(function(o){switch(o.label){case 0:return[4,fetch(t)];case 1:return[4,o.sent().arrayBuffer()];case 2:return r=o.sent(),[4,e.decodeAudioData(r)];case 3:return[2,o.sent()]}}))}))},t.prototype.arrayFrameGenerator=function(t,e,r){if(e>t.length)throw Error("`frameSize` shouldn't be greater than the length of input array!");if(r>e)throw Error("`hopSize` shouldn't be greater than `frameSize`!");for(var o=[];0<t.length-(e-1);0+r)o.push(t.slice(0,0+e));return o},t.prototype.compute=function(t){switch(this.extractorType){case"musicnn":if(512!=t.length)throw new Error("The chosen `extractorType` only works with an audio signal frame of 512 samples.");var e=this.essentia.TensorflowInputMusiCNN(this.arrayToVector(t));return{melSpectrum:this.vectorToArray(e.bands),batchSize:1,patchSize:187,melBandsSize:96};case"vggish":if(400!=t.length)throw new Error("The chosen `extractorType` only works with an audio signal frame of 400 samples.");e=this.essentia.TensorflowInputVGGish(this.arrayToVector(t));return{melSpectrum:this.vectorToArray(e.bands),batchSize:1,patchSize:96,melBandsSize:64};default:throw"Invalid 'extractorType' choice! Available types are [musicnn', 'vggish', 'tempocnn']"}},t.prototype.delete=function(){this.essentia.delete()},t.prototype.shutdown=function(){this.essentia.shutdown()},t}(),s=function(){function t(t,e,r){this.model=null,this.tf=null,this.isReady=!1,this.modelPath="",this.IS_TRAIN=null,this.randomTensorInput=null,this.tf=t,this.IS_TRAIN=this.tf.tensor([0],[1],"bool"),this.modelPath=e,this.isReady=!!this.model}return t.prototype.initialize=function(){return o(this,void 0,void 0,(function(){var t;return n(this,(function(e){switch(e.label){case 0:return t=this,[4,this.tf.loadGraphModel(this.modelPath)];case 1:return t.model=e.sent(),this.isReady=!0,[2]}}))}))},t.prototype.arrayToTensorAsBatches=function(t,e,r){var o,n,i=this.tf.tensor(t,e,"float32");return e[0]===r?i.as3D(1,r,e[1]):e[0]>=r?e[0]%r!=0?(n=Math.floor(e[0]/r)+1,o=this.tf.zeros([Math.floor((n*r*e[1]-t.length)/e[1]),e[1]],"float32"),i=i.concat(o),o.dispose(),i.as3D(n,r,e[1])):(n=Math.floor(e[0]/r),o=this.tf.zeros([Math.floor((n*r*e[1]-t.length)/e[1]),e[1]],"float32"),i=i.concat(o),o.dispose(),i.as3D(n,r,e[1])):(n=1,o=this.tf.zeros([r-e[0],e[1]]),i=i.concat(o),o.dispose(),i.as3D(n,r,e[1]))},t.prototype.dispose=function(){this.model.dispose()},t.prototype.disambiguateExtraInputs=function(){if(!this.isReady)throw Error("No loaded tfjs model found! Make sure to call `initialize` method and resolve the promise before calling `predict` method.");var t=this.model.executor.inputs.length;if(1===t)return[];if(2===t)return[this.IS_TRAIN.clone()];if(3===t)return this.randomTensorInput||(this.randomTensorInput=this.tf.zeros([1,this.model.executor.inputs[0].shape[1]])),[this.randomTensorInput.clone(),this.IS_TRAIN.clone()];throw Error("Found unsupported number of input requirements for the model. Expects the following inputs -> "+this.model.executor.inputs)},t}(),a=function(t){function e(e,r,o){return t.call(this,e,r)||this}return r(e,t),e.prototype.predict=function(t){return o(this,void 0,void 0,(function(){var e,r,o,i;return n(this,(function(n){switch(n.label){case 0:return e=this.arrayToTensorAsBatches(t.melSpectrum,[t.batchSize,t.melBandsSize],t.patchSize),(r=this.disambiguateExtraInputs()).push(e),o=this.model.execute(r),e.dispose(),[4,o.array()];case 1:return i=n.sent(),o.dispose(),[2,i]}}))}))},e}(s),u=function(t){function e(e,r,o){return t.call(this,e,r)||this}return r(e,t),e.prototype.predict=function(t){return o(this,void 0,void 0,(function(){var e,r,o,i;return n(this,(function(n){switch(n.label){case 0:return e=this.arrayToTensorAsBatches(t.melSpectrum,[t.batchSize,t.melBandsSize],t.patchSize),(r=this.disambiguateExtraInputs()).push(e),o=this.model.execute(r),e.dispose(),[4,o.array()];case 1:return i=n.sent(),o.dispose(),[2,i]}}))}))},e}(s);
/**
     * @license
     * Copyright (C) 2006-2020  Music Technology Group - Universitat Pompeu Fabra
     *
     * This file is part of Essentia
     *
     * Essentia is free software: you can redistribute it and/or modify it under
     * the terms of the GNU Affero General Public License as published by the Free
     * Software Foundation (FSF), either version 3 of the License, or (at your
     * option) any later version.
     *
     * This program is distributed in the hope that it will be useful, but WITHOUT
     * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
     * FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more
     * details.
     *
     * You should have received a copy of the Affero GNU General Public License
     * version 3 along with this program.  If not, see http://www.gnu.org/licenses/
     */return t.EssentiaTensorflowInputExtractor=i,t.EssentiaTensorflowJSModel=s,t.TensorflowMusiCNN=a,t.TensorflowVGGish=u,Object.defineProperty(t,"__esModule",{value:!0}),t}({});
